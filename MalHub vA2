-- MalHub LocalScript (copy-paste ready)

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()
local serverRemote = ReplicatedStorage:WaitForChild("MalHubServer")

-- Wait for character
if not player.Character or not player.Character:FindFirstChild("Humanoid") then
    player.CharacterAdded:Wait()
end

-- Settings
local defaultSpeed = 16
local defaultJumpPower = 50
local speed = defaultSpeed
local jumpPower = defaultJumpPower
local flingWhitelist = {}
local flingBlacklist = {}

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MalHub"
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

-- Draggable helper
local function makeDraggable(frame)
    local dragging, dragInput, mousePos, framePos = false
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mousePos
            frame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X,
                                       framePos.Y.Scale, framePos.Y.Offset + delta.Y)
        end
    end)
end

-- Main GUI
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0,400,0,600)
mainFrame.Position = UDim2.new(0.5,-200,0.5,-300)
mainFrame.BackgroundColor3 = Color3.fromRGB(150,0,0)
mainFrame.Visible = false
mainFrame.Parent = screenGui
makeDraggable(mainFrame)

-- Toggle Button
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0,120,0,40)
toggleBtn.Position = UDim2.new(0,20,0,20)
toggleBtn.Text = "MalHub"
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.TextSize = 18
toggleBtn.BackgroundColor3 = Color3.fromRGB(150,0,0)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Parent = screenGui
makeDraggable(toggleBtn)
toggleBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

-- Stats label
local statLabel = Instance.new("TextLabel")
statLabel.Size = UDim2.new(0,180,0,40)
statLabel.Position = UDim2.new(0,150,0,20)
statLabel.BackgroundTransparency = 1
statLabel.Font = Enum.Font.SourceSansBold
statLabel.TextSize = 16
statLabel.TextColor3 = Color3.fromRGB(255,255,255)
statLabel.Text = "Speed: "..speed.." | Jump: "..jumpPower
statLabel.Parent = screenGui

RunService.RenderStepped:Connect(function()
    statLabel.Text = "Speed: "..speed.." | Jump: "..jumpPower
end)

-- Tab Frames
local movementFrame = Instance.new("Frame"); movementFrame.Size=UDim2.new(1,-20,0,200); movementFrame.Position=UDim2.new(0,10,0,70); movementFrame.BackgroundTransparency=1; movementFrame.Parent=mainFrame
local visualsFrame = Instance.new("Frame"); visualsFrame.Size=UDim2.new(1,-20,0,200); visualsFrame.Position=UDim2.new(0,10,0,70); visualsFrame.BackgroundTransparency=1; visualsFrame.Visible=false; visualsFrame.Parent=mainFrame
local playersFrame = Instance.new("ScrollingFrame"); playersFrame.Size=UDim2.new(1,-20,0,300); playersFrame.Position=UDim2.new(0,10,0,280); playersFrame.BackgroundTransparency=1; playersFrame.Visible=false; playersFrame.CanvasSize=UDim2.new(0,0,0,0); playersFrame.Parent=mainFrame
local flingFrame = Instance.new("Frame"); flingFrame.Size=UDim2.new(1,-20,0,200); flingFrame.Position=UDim2.new(0,10,0,590); flingFrame.BackgroundTransparency=1; flingFrame.Visible=false; flingFrame.Parent=mainFrame

-- Tab Buttons
local function createTab(name,posY,frame)
    local btn=Instance.new("TextButton")
    btn.Size=UDim2.new(0,80,0,30); btn.Position=UDim2.new(0,20,0,posY)
    btn.Text=name; btn.Font=Enum.Font.SourceSansBold; btn.TextSize=16; btn.TextColor3=Color3.fromRGB(255,255,255)
    btn.BackgroundColor3=Color3.fromRGB(120,0,0); btn.Parent=mainFrame
    btn.MouseButton1Click:Connect(function()
        movementFrame.Visible=frame==movementFrame
        visualsFrame.Visible=frame==visualsFrame
        playersFrame.Visible=frame==playersFrame
        flingFrame.Visible=frame==flingFrame
    end)
end

createTab("Movement",0,movementFrame)
createTab("Visuals",40,visualsFrame)
createTab("Players",80,playersFrame)
createTab("Fling",120,flingFrame)

-- Movement Tab
local function createIncDec(name,yPos)
    local label=Instance.new("TextLabel")
    label.Size=UDim2.new(0,120,0,30); label.Position=UDim2.new(0,10,0,yPos)
    label.BackgroundTransparency=1; label.Font=Enum.Font.SourceSansBold; label.TextSize=16; label.TextColor3=Color3.fromRGB(255,255,255)
    label.Text=name..": "..(name=="Speed" and speed or jumpPower)
    label.Parent=movementFrame

    local inc=Instance.new("TextButton"); inc.Size=UDim2.new(0,30,0,30); inc.Position=UDim2.new(0,140,0,yPos); inc.Text="+"; inc.Font=Enum.Font.SourceSansBold; inc.TextSize=18; inc.Parent=movementFrame
    local dec=Instance.new("TextButton"); dec.Size=UDim2.new(0,30,0,30); dec.Position=UDim2.new(0,180,0,yPos); dec.Text="-"; dec.Font=Enum.Font.SourceSansBold; dec.TextSize=18; dec.Parent=movementFrame

    inc.MouseButton1Click:Connect(function()
        if name=="Speed" then speed=speed+2 else jumpPower=jumpPower+2 end
        label.Text=name..": "..(name=="Speed" and speed or jumpPower)
        if player.Character then
            if name=="Speed" then player.Character.Humanoid.WalkSpeed=speed else player.Character.Humanoid.JumpPower=jumpPower end
        end
    end)
    dec.MouseButton1Click:Connect(function()
        if name=="Speed" then speed=math.max(0,speed-2) else jumpPower=math.max(0,jumpPower-2) end
        label.Text=name..": "..(name=="Speed" and speed or jumpPower)
        if player.Character then
            if name=="Speed" then player.Character.Humanoid.WalkSpeed=speed else player.Character.Humanoid.JumpPower=jumpPower end
        end
    end)
end

createIncDec("Speed",10)
createIncDec("Jump",50)

-- Infinite Jump
local infiniteJumpToggle=Instance.new("TextButton")
infiniteJumpToggle.Size=UDim2.new(0,150,0,30); infiniteJumpToggle.Position=UDim2.new(0,10,0,90)
infiniteJumpToggle.Text="Infinite Jump: OFF"; infiniteJumpToggle.Font=Enum.Font.SourceSansBold; infiniteJumpToggle.TextSize=16; infiniteJumpToggle.TextColor3=Color3.fromRGB(255,255,255); infiniteJumpToggle.BackgroundColor3=Color3.fromRGB(150,0,0)
infiniteJumpToggle.Parent=movementFrame
local infiniteJump=false
infiniteJumpToggle.MouseButton1Click:Connect(function() infiniteJump=not infiniteJump; infiniteJumpToggle.Text="Infinite Jump: "..(infiniteJump and "ON" or "OFF") end)
UserInputService.JumpRequest:Connect(function()
    if infiniteJump and player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- NoClip
local noclipToggle=Instance.new("TextButton")
noclipToggle.Size=UDim2.new(0,150,0,30); noclipToggle.Position=UDim2.new(0,180,0,90)
noclipToggle.Text="NoClip: OFF"; noclipToggle.Font=Enum.Font.SourceSansBold; noclipToggle.TextSize=16; noclipToggle.TextColor3=Color3.fromRGB(255,255,255); noclipToggle.BackgroundColor3=Color3.fromRGB(150,0,0)
noclipToggle.Parent=movementFrame
local noclip=false
noclipToggle.MouseButton1Click:Connect(function() noclip=not noclip; noclipToggle.Text="NoClip: "..(noclip and "ON" or "OFF") end)
RunService.Stepped:Connect(function()
    if noclip and player.Character then
        for _, part in pairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide=false end
        end
    end
end)

-- Visuals Tab (ESP)
local espToggle=Instance.new("TextButton")
espToggle.Size=UDim2.new(0,150,0,30); espToggle.Position=UDim2.new(0,10,0,10)
espToggle.Text="ESP: OFF"; espToggle.Font=Enum.Font.SourceSansBold; espToggle.TextSize=16; espToggle.TextColor3=Color3.fromRGB(255,255,255); espToggle.BackgroundColor3=Color3.fromRGB(150,0,0)
espToggle.Parent=visualsFrame
local espEnabled=false
espToggle.MouseButton1Click:Connect(function() espEnabled=not espEnabled; espToggle.Text="ESP: "..(espEnabled and "ON" or "OFF") end)

local espBoxes={}
RunService.RenderStepped:Connect(function()
    if espEnabled then
        for _, p in pairs(Players:GetPlayers()) do
            if p~=player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                if not espBoxes[p.Name] then
                    local box=Instance.new("BillboardGui"); box.Name="ESPBox"; box.Size=UDim2.new(0,100,0,50); box.Adornee=p.Character.HumanoidRootPart; box.AlwaysOnTop=true; box.Parent=screenGui
                    local label=Instance.new("TextLabel"); label.Size=UDim2.new(1,0,1,0); label.BackgroundTransparency=1; label.TextColor3=Color3.fromRGB(255,0,0); label.TextStrokeTransparency=0; label.Text=p.Name; label.Font=Enum.Font.SourceSansBold; label.TextScaled=true; label.Parent=box
                    espBoxes[p.Name]=box
                end
            end
        end
    else
        for _, box in pairs(espBoxes) do box:Destroy() end; espBoxes={}
    end
end)

-- Players Tab & Inventory Popup (fully integrated)  
-- [Here you can paste the Players tab + inventory popup code from the previous full section]

-- Fling Tab (Fling Aura, Auto Fling, Anti Fling)  
-- [Here you can paste the Fling tab code from the previous full section]


-- === Players Tab ===
local invFrame = Instance.new("Frame")
invFrame.Size = UDim2.new(0,250,0,300)
invFrame.Position = UDim2.new(0.5,-125,0.5,-150)
invFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
invFrame.BorderSizePixel = 0
invFrame.Visible = false
invFrame.Parent = screenGui
makeDraggable(invFrame)

local invTitle = Instance.new("TextLabel")
invTitle.Size = UDim2.new(1,0,0,30)
invTitle.Position = UDim2.new(0,0,0,0)
invTitle.BackgroundTransparency = 1
invTitle.Font = Enum.Font.SourceSansBold
invTitle.TextSize = 18
invTitle.TextColor3 = Color3.fromRGB(255,255,255)
invTitle.Text = "Inventory"
invTitle.Parent = invFrame

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0,50,0,30)
closeBtn.Position = UDim2.new(1,-55,0,0)
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 16
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.BackgroundColor3 = Color3.fromRGB(150,0,0)
closeBtn.Parent = invFrame
closeBtn.MouseButton1Click:Connect(function() invFrame.Visible = false end)

local invList = Instance.new("ScrollingFrame")
invList.Size = UDim2.new(1,-10,1,-40)
invList.Position = UDim2.new(0,5,0,35)
invList.BackgroundTransparency = 1
invList.CanvasSize = UDim2.new(0,0,0,0)
invList.Parent = invFrame

-- Refresh Players List
local function refreshPlayers()
    for _, child in pairs(playersFrame:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end
    local y=0
    for _, p in pairs(Players:GetPlayers()) do
        local frame=Instance.new("Frame")
        frame.Size = UDim2.new(0,320,0,50)
        frame.Position = UDim2.new(0,0,0,y)
        frame.BackgroundColor3 = Color3.fromRGB(100,100,100)
        frame.BackgroundTransparency = 0.8
        frame.Parent = playersFrame

        local thumbId = Players:GetUserThumbnailAsync(p.UserId,Enum.ThumbnailType.HeadShot,Enum.ThumbnailSize.Size48x48)
        local img = Instance.new("ImageLabel")
        img.Size=UDim2.new(0,40,0,40); img.Position=UDim2.new(0,5,0,5); img.BackgroundTransparency=1; img.Image=thumbId; img.Parent=frame

        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size=UDim2.new(0,120,0,40); nameLabel.Position=UDim2.new(0,50,0,5)
        nameLabel.BackgroundTransparency=1; nameLabel.Font=Enum.Font.SourceSansBold; nameLabel.TextSize=18; nameLabel.TextColor3=Color3.fromRGB(255,255,255); nameLabel.Text=p.Name
        nameLabel.Parent = frame

        local healthBg = Instance.new("Frame")
        healthBg.Size=UDim2.new(0,200,0,10); healthBg.Position=UDim2.new(0,50,0,35); healthBg.BackgroundColor3=Color3.fromRGB(50,50,50); healthBg.BorderSizePixel=0; healthBg.Parent=frame
        local healthBar = Instance.new("Frame")
        healthBar.Size=UDim2.new(1,0,1,0); healthBar.BackgroundColor3=Color3.fromRGB(0,255,0); healthBar.BorderSizePixel=0; healthBar.Parent=healthBg
        local healthLabel = Instance.new("TextLabel")
        healthLabel.Size=UDim2.new(1,0,1,0); healthLabel.BackgroundTransparency=1; healthLabel.Font=Enum.Font.SourceSansBold; healthLabel.TextSize=12; healthLabel.TextColor3=Color3.fromRGB(255,255,255); healthLabel.Text="100 / 100"; healthLabel.Parent=healthBg

        RunService.RenderStepped:Connect(function()
            if p.Character and p.Character:FindFirstChild("Humanoid") then
                local humanoid = p.Character.Humanoid
                local ratio = math.clamp(humanoid.Health/humanoid.MaxHealth,0,1)
                healthBar.Size = UDim2.new(ratio,0,1,0)
                healthLabel.Text = string.format("%d / %d", math.floor(humanoid.Health), math.floor(humanoid.MaxHealth))
            else
                healthBar.Size = UDim2.new(0,0,1,0)
                healthLabel.Text = "0 / 0"
            end
        end)

        -- Inventory Click
        frame.InputBegan:Connect(function(input)
            if input.UserInputType==Enum.UserInputType.MouseButton1 then
                serverRemote:FireServer("GetInventory",p.Name)
                invFrame.Visible=true
                invTitle.Text=p.Name.."'s Inventory"
            elseif input.UserInputType==Enum.UserInputType.MouseButton2 then
                serverRemote:FireServer("TeleportToPlayer",p.Name)
            end
        end)

        y = y + 55
    end
    playersFrame.CanvasSize = UDim2.new(0,0,0,y)
end
refreshPlayers()

-- Receive Inventory from Server
serverRemote.OnClientEvent:Connect(function(action,targetName,items)
    if action=="InventoryResult" then
        for _, c in pairs(invList:GetChildren()) do if c:IsA("TextLabel") then c:Destroy() end end
        local y=0
        for _, item in pairs(items) do
            local lbl=Instance.new("TextLabel")
            lbl.Size=UDim2.new(1,0,0,25); lbl.Position=UDim2.new(0,0,0,y); lbl.BackgroundColor3=Color3.fromRGB(100,100,100); lbl.BackgroundTransparency=0.5
            lbl.Font=Enum.Font.SourceSansBold; lbl.TextSize=16; lbl.TextColor3=Color3.fromRGB(255,255,255); lbl.Text=item; lbl.Parent=invList
            y=y+30
        end
        invList.CanvasSize = UDim2.new(0,0,0,y)
    end
end)

-- === Fling Tab ===
local function createFlingToggle(name,x,y)
    local btn=Instance.new("TextButton")
    btn.Size=UDim2.new(0,150,0,30); btn.Position=UDim2.new(0,x,0,y); btn.Font=Enum.Font.SourceSansBold; btn.TextSize=16; btn.TextColor3=Color3.fromRGB(255,255,255); btn.BackgroundColor3=Color3.fromRGB(150,0,0)
    btn.Text=name..": OFF"; btn.Parent=flingFrame
    local state=false
    btn.MouseButton1Click:Connect(function() state=not state; btn.Text=name..": "..(state and "ON" or "OFF") end)
    return btn,function() return state end
end

local flingAuraToggle, getFlingAura = createFlingToggle("Fling Aura",10,10)
local antiFlingToggle, getAntiFling = createFlingToggle("Anti Fling",180,10)
local autoFlingToggle, getAutoFling = createFlingToggle("Auto Fling",10,50)

RunService.RenderStepped:Connect(function()
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = player.Character.HumanoidRootPart
        -- Anti Fling
        if getAntiFling() then hrp.Velocity=Vector3.new(0,hrp.Velocity.Y,0) end
        -- Aura / Auto Fling
        for _, target in pairs(Players:GetPlayers()) do
            if target~=player and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                local trp = target.Character.HumanoidRootPart
                local dist = (hrp.Position-trp.Position).Magnitude
                if flingWhitelist[target.Name] then continue end
                if next(flingBlacklist) and not flingBlacklist[target.Name] then continue end
                if getFlingAura() and dist<10 then trp.Velocity=Vector3.new(0,50,0) end
                if getAutoFling() and dist<15 then trp.Velocity=Vector3.new(0,70,0) end
            end
        end
    end
end)



-- === Players Tab: Whitelist / Blacklist Buttons ===
local function addWhitelistBlacklistButtons(playerFrame, targetPlayer)
    -- Whitelist button
    local wlBtn = Instance.new("TextButton")
    wlBtn.Size = UDim2.new(0,90,1,0)
    wlBtn.Position = UDim2.new(0,130,0,0)
    wlBtn.Font = Enum.Font.SourceSansBold
    wlBtn.TextSize = 14
    wlBtn.TextColor3 = Color3.fromRGB(255,255,255)
    wlBtn.BackgroundColor3 = Color3.fromRGB(0,150,0)
    wlBtn.Text = (flingWhitelist[targetPlayer.Name] and "Whitelisted" or "Whitelist")
    wlBtn.Parent = playerFrame

    wlBtn.MouseButton1Click:Connect(function()
        if flingWhitelist[targetPlayer.Name] then
            flingWhitelist[targetPlayer.Name] = nil
        else
            flingWhitelist[targetPlayer.Name] = true
            flingBlacklist[targetPlayer.Name] = nil
        end
        refreshPlayers()
    end)

    -- Blacklist button
    local blBtn = Instance.new("TextButton")
    blBtn.Size = UDim2.new(0,90,1,0)
    blBtn.Position = UDim2.new(0,230,0,0)
    blBtn.Font = Enum.Font.SourceSansBold
    blBtn.TextSize = 14
    blBtn.TextColor3 = Color3.fromRGB(255,255,255)
    blBtn.BackgroundColor3 = Color3.fromRGB(150,0,0)
    blBtn.Text = (flingBlacklist[targetPlayer.Name] and "Blacklisted" or "Blacklist")
    blBtn.Parent = playerFrame

    blBtn.MouseButton1Click:Connect(function()
        if flingBlacklist[targetPlayer.Name] then
            flingBlacklist[targetPlayer.Name] = nil
        else
            flingBlacklist[targetPlayer.Name] = true
            flingWhitelist[targetPlayer.Name] = nil
        end
        refreshPlayers()
    end)
end

-- Update refreshPlayers function to include whitelist/blacklist buttons
local function refreshPlayers()
    for _, child in pairs(playersFrame:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end
    local y = 0
    for _, p in pairs(Players:GetPlayers()) do
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0,320,0,50)
        frame.Position = UDim2.new(0,0,0,y)
        -- Color code frame based on whitelist/blacklist
        if flingWhitelist[p.Name] then
            frame.BackgroundColor3 = Color3.fromRGB(0,150,0)
        elseif flingBlacklist[p.Name] then
            frame.BackgroundColor3 = Color3.fromRGB(150,0,0)
        else
            frame.BackgroundColor3 = Color3.fromRGB(100,100,100)
        end
        frame.BackgroundTransparency = 0.8
        frame.Parent = playersFrame

        -- Profile Image
        local thumbId = Players:GetUserThumbnailAsync(p.UserId,Enum.ThumbnailType.HeadShot,Enum.ThumbnailSize.Size48x48)
        local img = Instance.new("ImageLabel")
        img.Size = UDim2.new(0,40,0,40)
        img.Position = UDim2.new(0,5,0,5)
        img.BackgroundTransparency = 1
        img.Image = thumbId
        img.Parent = frame

        -- Name Label
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(0,120,0,40)
        nameLabel.Position = UDim2.new(0,50,0,5)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Font = Enum.Font.SourceSansBold
        nameLabel.TextSize = 18
        nameLabel.TextColor3 = Color3.fromRGB(255,255,255)
        nameLabel.Text = p.Name
        nameLabel.Parent = frame

        -- Health Bar
        local healthBg = Instance.new("Frame")
        healthBg.Size = UDim2.new(0,200,0,10)
        healthBg.Position = UDim2.new(0,50,0,35)
        healthBg.BackgroundColor3 = Color3.fromRGB(50,50,50)
        healthBg.BorderSizePixel = 0
        healthBg.Parent = frame

        local healthBar = Instance.new("Frame")
        healthBar.Size = UDim2.new(1,0,1,0)
        healthBar.BackgroundColor3 = Color3.fromRGB(0,255,0)
        healthBar.BorderSizePixel = 0
        healthBar.Parent = healthBg

        local healthLabel = Instance.new("TextLabel")
        healthLabel.Size = UDim2.new(1,0,1,0)
        healthLabel.BackgroundTransparency = 1
        healthLabel.Font = Enum.Font.SourceSansBold
        healthLabel.TextSize = 12
        healthLabel.TextColor3 = Color3.fromRGB(255,255,255)
        healthLabel.Text = "100 / 100"
        healthLabel.Parent = healthBg

        RunService.RenderStepped:Connect(function()
            if p.Character and p.Character:FindFirstChild("Humanoid") then
                local humanoid = p.Character.Humanoid
                local ratio = math.clamp(humanoid.Health/humanoid.MaxHealth,0,1)
                healthBar.Size = UDim2.new(ratio,0,1,0)
                healthLabel.Text = string.format("%d / %d", math.floor(humanoid.Health), math.floor(humanoid.MaxHealth))
            else
                healthBar.Size = UDim2.new(0,0,1,0)
                healthLabel.Text = "0 / 0"
            end
        end)

        -- Inventory & Teleport
        frame.InputBegan:Connect(function(input)
            if input.UserInputType==Enum.UserInputType.MouseButton1 then
                serverRemote:FireServer("GetInventory",p.Name)
                invFrame.Visible=true
                invTitle.Text=p.Name.."'s Inventory"
            elseif input.UserInputType==Enum.UserInputType.MouseButton2 then
                serverRemote:FireServer("TeleportToPlayer",p.Name)
            end
        end)

        -- Add Whitelist / Blacklist buttons
        addWhitelistBlacklistButtons(frame, p)

        y = y + 55
    end
    playersFrame.CanvasSize = UDim2.new(0,0,0,y)
end

refreshPlayers()


-- === Clear Whitelist/Blacklist Button ===
local clearBtn = Instance.new("TextButton")
clearBtn.Size = UDim2.new(0,200,0,30)
clearBtn.Position = UDim2.new(0,60,0,0) -- Top of the players frame
clearBtn.Font = Enum.Font.SourceSansBold
clearBtn.TextSize = 16
clearBtn.TextColor3 = Color3.fromRGB(255,255,255)
clearBtn.BackgroundColor3 = Color3.fromRGB(100,0,0)
clearBtn.Text = "Clear Whitelist/Blacklist"
clearBtn.Parent = playersFrame

clearBtn.MouseButton1Click:Connect(function()
    flingWhitelist = {}
    flingBlacklist = {}
    refreshPlayers()
end)

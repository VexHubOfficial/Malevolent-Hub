-- ==================== SECTION 1 ====================
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local uis = game:GetService("UserInputService")
local runService = game:GetService("RunService")
local players = game:GetService("Players")
local debris = game:GetService("Debris")

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MalHub"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0,120,0,40)
toggleButton.Position = UDim2.new(0,20,0,20)
toggleButton.Text = "MalHub"
toggleButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
toggleButton.TextColor3 = Color3.fromRGB(255,255,255)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextScaled = true
toggleButton.Active = true
toggleButton.Draggable = true
toggleButton.Parent = screenGui

-- Main Panel
local panel = Instance.new("Frame")
panel.Size = UDim2.new(0,350,0,350)
panel.Position = UDim2.new(0,20,0,70)
panel.BackgroundColor3 = Color3.fromRGB(40,10,10)
panel.BorderSizePixel = 0
panel.Visible = false
panel.Parent = screenGui

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0,10)
uiCorner.Parent = panel

-- Tab Bar
local tabBar = Instance.new("Frame")
tabBar.Size = UDim2.new(0,100,1,0)
tabBar.Position = UDim2.new(0,0,0,0)
tabBar.BackgroundColor3 = Color3.fromRGB(80,0,0)
tabBar.BorderSizePixel = 0
tabBar.Parent = panel

local tabCorner = Instance.new("UICorner")
tabCorner.CornerRadius = UDim.new(0,10)
tabCorner.Parent = tabBar

local tabFrames = {}

-- Tabs: Player & Settings
local tabs = {"Player","Settings"}
for i, tabName in ipairs(tabs) do
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1,0,0,50)
    button.Position = UDim2.new(0,0,0,(i-1)*50)
    button.Text = tabName
    button.Font = Enum.Font.GothamBold
    button.TextColor3 = Color3.fromRGB(255,255,255)
    button.BackgroundColor3 = Color3.fromRGB(150,0,0)
    button.Parent = tabBar

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,5)
    corner.Parent = button

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1,-100,1,0)
    frame.Position = UDim2.new(0,100,0,0)
    frame.BackgroundTransparency = 1
    frame.Visible = (i==1)
    frame.Parent = panel
    tabFrames[tabName] = frame

    button.MouseButton1Click:Connect(function()
        for _, f in pairs(tabFrames) do f.Visible = false end
        frame.Visible = true
    end)
end

-- ========== UTILITIES: Slider and Toggle Functions (Red Theme) ==========
local function createSlider(parent,labelText,min,max,default,callback,posY)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0,200,0,30)
    label.Position = UDim2.new(0,20,0,posY)
    label.Text = labelText..": "..default
    label.Font = Enum.Font.Gotham
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = parent

    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(0,200,0,20)
    sliderFrame.Position = UDim2.new(0,20,0,posY+30)
    sliderFrame.BackgroundColor3 = Color3.fromRGB(120,0,0)
    sliderFrame.Parent = parent

    local sliderFill = Instance.new("Frame")
    sliderFill.Size = UDim2.new((default-min)/(max-min),0,1,0)
    sliderFill.BackgroundColor3 = Color3.fromRGB(255,0,0)
    sliderFill.Parent = sliderFrame

    local dragging = false
    sliderFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end
    end)
    sliderFrame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)
    uis.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local relativeX = math.clamp(input.Position.X - sliderFrame.AbsolutePosition.X,0,sliderFrame.AbsoluteSize.X)
            local value = min + (relativeX/sliderFrame.AbsoluteSize.X)*(max-min)
            sliderFill.Size = UDim2.new((value-min)/(max-min),0,1,0)
            label.Text = labelText..": "..math.floor(value)
            callback(value)
        end
    end)
end

local function createToggle(parent,labelText,default,callback,posY)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0,150,0,30)
    label.Position = UDim2.new(0,20,0,posY)
    label.Text = labelText
    label.Font = Enum.Font.Gotham
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = parent

    local toggleFrame = Instance.new("Frame")
    toggleFrame.Size = UDim2.new(0,40,0,20)
    toggleFrame.Position = UDim2.new(0,180,0,posY+5)
    toggleFrame.BackgroundColor3 = Color3.fromRGB(120,0,0)
    toggleFrame.Parent = parent

    local toggleFill = Instance.new("Frame")
    toggleFill.Size = UDim2.new(default and 1 or 0,0,1,0)
    toggleFill.BackgroundColor3 = Color3.fromRGB(255,0,0)
    toggleFill.Parent = toggleFrame

    toggleFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            default = not default
            toggleFill.Size = UDim2.new(default and 1 or 0,0,1,0)
            callback(default)
        end
    end)
end

-- ================= PLAYER TAB =================
local playerTab = tabFrames["Player"]
local sliderY = 20

-- Movement sliders
createSlider(playerTab,"Speed",16,100,humanoid.WalkSpeed,function(val) humanoid.WalkSpeed=val end,sliderY)
createSlider(playerTab,"JumpPower",50,200,humanoid.JumpPower,function(val) humanoid.JumpPower=val end,sliderY+70)

-- Infinite Jump
local infiniteJump = false
createToggle(playerTab,"Infinite Jump",false,function(state) infiniteJump=state end,sliderY+140)

-- Noclip
local noclipEnabled = false
createToggle(playerTab,"Noclip",false,function(state) noclipEnabled=state end,sliderY+180)

-- Anti-Fling Whitelist (Section 2 will fill the logic)
local flingWhitelist = {}

-- ================= SETTINGS TAB =================
local settingsTab = tabFrames["Settings"]
local toggleY2 = 20

-- Anti-Fling
local antiFlingEnabled = false
createToggle(settingsTab,"Anti-Fling",false,function(state) antiFlingEnabled=state end,toggleY2)

-- Fling Aura
local flingAuraEnabled = false
createToggle(settingsTab,"Fling Aura",false,function(state) flingAuraEnabled=state end,toggleY2+50)

-- ESP
local espEnabled = false
createToggle(settingsTab,"ESP / Highlight",false,function(state) espEnabled=state end,toggleY2+100)

-- Toggle panel visibility
toggleButton.MouseButton1Click:Connect(function() panel.Visible = not panel.Visible end)


-- ==================== SECTION 2 ====================

-- PLAYER TOOLS TAB
local playerToolsTab = Instance.new("Frame")
playerToolsTab.Size = UDim2.new(1,-100,1,0)
playerToolsTab.Position = UDim2.new(0,100,0,0)
playerToolsTab.BackgroundTransparency = 1
playerToolsTab.Visible = false
playerToolsTab.Parent = panel
tabFrames["Player Tools"] = playerToolsTab

-- Tab button
local button3 = Instance.new("TextButton")
button3.Size = UDim2.new(1,0,0,50)
button3.Position = UDim2.new(0,0,0,100)
button3.Text = "Player Tools"
button3.Font = Enum.Font.GothamBold
button3.TextColor3 = Color3.fromRGB(255,255,255)
button3.BackgroundColor3 = Color3.fromRGB(150,0,0)
button3.Parent = tabBar

local corner3 = Instance.new("UICorner")
corner3.CornerRadius = UDim.new(0,5)
corner3.Parent = button3

button3.MouseButton1Click:Connect(function()
    for _, f in pairs(tabFrames) do f.Visible=false end
    playerToolsTab.Visible = true
end)

-- Player Name Box
local playerNameBox = Instance.new("TextBox")
playerNameBox.Size = UDim2.new(0,200,0,30)
playerNameBox.Position = UDim2.new(0,20,0,20)
playerNameBox.PlaceholderText = "Player Name"
playerNameBox.ClearTextOnFocus=false
playerNameBox.Text=""
playerNameBox.Parent=playerToolsTab

-- Teleport Button
local tpButton = Instance.new("TextButton")
tpButton.Size = UDim2.new(0,100,0,30)
tpButton.Position = UDim2.new(0,230,0,20)
tpButton.Text="Teleport"
tpButton.BackgroundColor3=Color3.fromRGB(255,0,0)
tpButton.TextColor3=Color3.fromRGB(255,255,255)
tpButton.Font=Enum.Font.GothamBold
tpButton.Parent=playerToolsTab

tpButton.MouseButton1Click:Connect(function()
    local targetName = playerNameBox.Text
    local targetPlayer = players:FindFirstChild(targetName)
    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        character:SetPrimaryPartCFrame(targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,5,0))
    end
end)

-- ESP / Remove
